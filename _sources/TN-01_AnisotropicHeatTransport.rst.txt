TN-01_AnisotropicHeatTransport
==============================

.. meta::
   :description: technical note

   :keywords: Anisotropic,Heat,Transport,Tutorials,March,23,,2022,Department,of,Aeronautics,,Imperial,College,London,,UK,Department,of,Engineering,,King’s,College,London,,UK,2,Chapter,1,Introduction,This,tutorial,describes,the,use,of,the,spectral/hp,element,framework,Nektar++,to,model,heat,transport,in,highly,anisotropic,domains.,Information,on,how,to,install,the,libraries,,solvers,,and,utilities,on,your,own,computer,is,available,on,the,webpage,www.nektar.info.,For,this,tutorial,we,will,require,a,speciﬁc,Nektar++,branch,which,contains,a,version,of,NekMesh,with,the,following,additional,features:,CAD,based,edge,and,curve,reﬁnement;,CAD,based,r-adaption.,Additionally,,the,anisotropic,thermal,conduction,proxy-app,with,matrix,free,operators,also,needs,to,be,downloaded,and,installed.,Speciﬁc,instructions,for,downloading,and,installing,the,above,will,be,given,in,the,following,section,of,the,tutorial.,3,4,Chapter,1,Introduction,Task,1.1,Prepare,for,the,tutorial.,Make,sure,that,you,have:,•,Cloned,the,feature/r-adapt-curves,branch,containing,the,additional,NekMesh,features.,•,Installed,and,tested,Nektar++,,,compiled,it,from,source,above,branch.,The,sources,may,be,compiled,with,the,CMake,option,NEKTAR_USE_MPI,set,to,ON,for,faster,execution.,Additionally,,to,enable,NekMesh,the,CMake,op-,tions,NEKTAR_UTILITY_NEKMESH,and,NEKTAR_UTILITY_FIELDCONVERT,must,be,set,to,ON.,Lastly,,NekMesh,utilises,boost,pthreads,for,parallelisation,,which,requires,the,CMake,option,NEKTAR_USE_THREAD_SAFETY,.,Note,that,by,default,,the,compiled,executables,will,be,installed,in,dist/bin,of,the,build,directory,you,created,in,the,Nektar++,source,tree.,We,will,refer,to,the,directory,containing,the,executables,as,$NEK,for,the,remainder,of,the,tutorial.,•,The,MatrixFree,operators,are,enabled,by,default,while,installing,Nek-,tar++.,However,,in,order,to,access,the,best,performance,of,MatrixFree,op-,erators,,the,following,CMake,options,can,be,used,to,conﬁgure,Nektar++:,CMAKE_CXX_FLAGS,set,to,-mavx2,-mfma,and,NEKTAR_ENABLE_SIMD_VMATH,set,to,ON,source,code,by,typing,the,•,The,anisotropic,thermal,conduction,proxy-app,can,be,installed,from,the,following,command,in,terminal,git@gitlab.nektar.info:neptune/nektar-diffusion.git,and,linking,installed,Nektar++,package,by,setting,as,$NEK/build,(where,Nektar++Config.cmake,and,Nektar++_DIR,nektar++-config.cmake,are,generated,during,installation,of,Nektar++).,it,with,the,•,Downloaded,the,tutorial,ﬁles:,http://doc.nektar.info/tutorials/5.,2.0/neptune-heat-transport/neptune-heat-transport.tar.gz,Unpack,it,using,unzip,neptune-heat-transport.tar.gz,to,pro-,duce,a,directory,neptune-heat-transport,with,subdirectories,called,tutorial,and,complete,.,We,will,refer,to,the,tutorial,directory,as,$NEKTUTORIAL,.,The,necessary,ﬁles,to,complete,this,tutorial,are,included,in,the,.zip,folder,downloaded,using,the,link,in,Task,1.1.,Under,the,folder,tutorial,,the,user,will,ﬁnd,ﬁles,and,folders,to,complete,both,the,meshing,and,solver,sections,of,the,tutorial.,For,the,mesh,generation,,a,CAD,STEP,ﬁle,heat-transport.step,of,the,computational,domain,and,a,basic,mesh,conﬁguration,ﬁle,heat-transport_coarse.mcf,are,provided.,For,the,solver,section,the,user,will,ﬁnd,two,sub-folders,,one,for,steady,cases,and,the,other,one,for,unsteady,cases,using,MatrixFree,operators.,Chapter,1,Introduction,5,•,Folder,Steady_08Ang_matrix_free,–,domain.xml,-,NekMesh,ﬁle,–,conditions.xml,-,XML,session,ﬁle,•,Folder,Unsteady_08Ang_matrix_free,–,domain.xml,-,NekMesh,ﬁle,–,conditions.xml,-,XML,session,ﬁle,The,folder,completed,that,can,also,be,found,in,the,.zip,contains,the,generated,mesh,ﬁles,heat-transport_coarse.xml,and,heat-transport_refined.xml,to,be,used,as,a,check,in,case,the,user,gets,stuck,,to,the,correctness,at,the,end,of,the,meshing,portion,of,the,tutorial,,or,to,directly,jump,to,the,solver,portion,of,the,tutorial.,Chapter,2,Background,Anisotropic,heat,transport,is,important,in,the,tokamak,edge,simulation,,where,the,stability,and,control,of,thermonuclear,fusion,process,in,tokamak,is,closely,related,to,the,anisotropic,transport,of,thermal,energy,in,magnetized,plasma.,Due,to,the,presence,of,magnetic,ﬁeld,and,the,ionized,nature,of,plasma,,the,thermal,conduction,of,the,magnetized,plasma,is,anisotropic.,Because,of,the,anisotropy,of,thermal,conduction,,the,diﬀusion,tensor,becomes,non-diagonal,,and,a,sense,of,directionality,is,introduced,into,the,normally,uniformly,dissipative,characteristics,of,the,diﬀusion,term.,This,tutorial,is,split,in,to,two,parts.,In,the,ﬁrst,part,,the,methods,used,to,generate,a,mesh,suitable,for,anisotropic,heat,transport,using,the,Nektar++,mesh,generation,tool,,NekMesh,is,covered,from,CAD,to,fully,reﬁned,mesh.,In,the,second,part,,the,variational,formulation,and,the,key,parameters,of,the,anisotropic,thermal,conduction,is,derived.,The,MatrixFree,operators,with,SIMD,vectorization,operators,are,implemented,in,Nektar++,framework,to,conduct,the,relevant,simulations.,The,case,used,in,the,tutorial,represents,thermal,conduction,in,an,stretched,domain,where,the,magnetic,ﬁeld,lines,are,in,a,tilted,by,θ,=,49.238,degrees,oﬀ,the,horizontal,as,depicted,in,ﬁgure,2.1.,Figure,2.1,CAD,representation,of,the,anisotropic,computational,domain,showing,the,ﬁve,distinct,faces,at,its,original,scale.,The,width,of,the,domain,is,set,to,Lx,=,5m,and,its,width,Ly,=,0.2m.,The,two,red,faces,separating,the,orange,face,from,the,blue,(bottom),and,green,(top),represent,the,magnetic,ﬁeld,lines,of,the,plasma.,A,zoomed,in,view,if,provided,in,ﬁgure,3.1.,6,2.1,Governing,equation,The,general,form,of,anisotropic,thermal,conduction,of,magnetized,plasma,is,2.1,Governing,equation,7,3,2,n,dT,dt,h,=,∇,·,κkb(b,·,∇T,),+,κ⊥,(cid:0)∇T,−,b(b,·,∇T,)(cid:1),+,κ∧b,×,∇T,i,+,Q,h,=,∇,·,κk(b,⊗,b),·,∇T,+,κ⊥(I,−,b,⊗,b),·,∇T,+,κ∧b,×,∇T,h(cid:0)(κk,−,κ⊥)(b,⊗,b),+,κ⊥I(cid:1),·,∇T,=,∇,·,=,∇,·,(cid:0)κc,·,∇T,(cid:1),+,∇,·,[κ∧b,×,∇T,],+,Q,i,+,∇,·,[κ∧b,×,∇T,],+,Q,i,+,Q,(2.1),x,=,cs2,,bxby,=,cs,ss,and,b2,where,I,is,an,identity,matrix.,κc,is,deﬁned,as,the,thermal,conductivity,tensor,and,b,=,[bx,,by]0,=,[cos(θ),,sin(θ)]0,=,[cs,,ss]0,,where,the,superscript,(0),is,a,transpose,operator.,Consequently,,b2,y,=,ss2.,In,this,study,,since,it,is,assumed,that,the,anisotropic,thermal,conduction,in,magnetized,plasma,is,two-dimensional,,the,induction,direction,κ∧,in,the,3rd,dimension,(the,term,∇,·,[κ∧b,×,∇T,],in,Equation,(2.1)),is,neglected.,Therefore,,the,implemented,strong,form,of,two-dimensional,anisotropic,thermal,conduction,becomes,3,2,n,dT,dt,=,∇,·,"(cid:0)(κk,−,κ⊥)cs2,+,κ⊥,(cid:1)∂xT,+,(cid:0)(κk,−,κ⊥)cs,ss(cid:1)∂yT,(cid:0)(κk,−,κ⊥)cs,ss(cid:1)∂xT,+,(cid:0)(κk,−,κ⊥)ss2,+,κ⊥)∂yT,#,+,Q,(2.2),2.1.1,Key,parameters,Braginskii’s,transport,coeﬃcients,are,widely,used,in,tokamak,edge,modelling.,The,Barginskii,transport,coeﬃcients,for,ions,(i),and,electrons,(e),are,deﬁned,in,Equation,(2.3).,κe,k,=,3.2,κi,k,=,3.9,nkBTeτe,me,nkBTiτi,mi,;,κe,⊥,=,4.7,;,κe,∧,=,;,κi,⊥,=,2.0,;,κi,∧,=,nkBTe,meω2,ceτe,nkBTi,miω2,ciτi,nkBTe,5,2,meωce,nkBTi,5,miωci,2,(2.3a),(2.3b),Due,to,the,anisotropic,nature,of,the,magnetized,plasma,,the,magnitudes,of,diﬀusion,coeﬃcients,for,ions,and,electrons,are,very,disparate,,so,one,or,other,might,be,neglected.,Assuming,B,is,of,order,unity,(in,Tesla),and,Te,≈,Ti,,so,κk,(cid:29),κ⊥.,Hence,the,thermal,conductivity,coeﬃcients,in,Equation,(2.2),are,chosen,as,κk,≈,κe,⊥.,Therefore,,the,κk,and,κ⊥,can,be,written,as,k,and,κ⊥,≈,κi,√,κk,=,19.2,2π3,1,√,me,(cid:15)2,0,e4,(kBTe)5/2,Z2λ,κ⊥,=,1,√,π3,6,1,mi,(cid:16),nZe,B(cid:15)0,(cid:17)2,(mpA)3/2λ,√,kBTi,(2.4),8,Chapter,2,Background,2.1.2,Variational,formulation,We,ﬁrst,deﬁne,an,appropriate,set,of,ﬁnite,trial,function,space,(Sh),for,the,temperature,ﬁeld,and,its,corresponding,ﬁnite,test,function,spaces,(V,h),,where,the,superscript,(h),denotes,a,ﬁnite,function,space,,e.g,,Sh,⊂,S.,Hence,the,variational,formulation,of,for,all,ψh,∈,V,h,,ﬁnd,T,h,∈,Sh,such,that,Equation,(2.2),can,be,written,as,follow:,Equation,(2.5),is,satisﬁed.,3,2,n,Z,Ω,[ψh,dT,h,dt,]dΩ,+,Z,[∇ψh,·,(κc,·,∇T,h)]dΩ,=,Ω,Z,Z,Ω,[ψhQh]dΩ,+,[ψh(κc,·,∇T,h),·,n]dΓ,∀ψh,∈,V,h,(2.5),Γ,Assuming,a,steady,case,without,external,heat,source,,the,ﬁrst,and,third,terms,in,Equation,(2.5),can,be,neglected.,On,the,other,hand,,an,appropriate,time,integration,scheme,should,be,employed,for,an,unsteady,simulation,of,the,anisotropic,thermal,conduction.,Chapter,3,2D,Mesh,Generation,This,section,of,the,tutorial,covers,the,mesh,generation,methodology,detailed,in,report,D1.1,1,where,the,technicalities,of,the,methods,discussed,thereafter,are,explained,in,more,detail.,The,mesh,generation,starts,from,a,valid,CAD,ﬁle,which,must,follow,the,following,format:,1.,np,curves,can,be,periodic,,i.e.,each,curve,has,two,distinct,non-overlapping,end,vertices,,or,in,other,words,that,for,the,parametrisation,of,the,curve,,r(t),,there,does,not,exist,a,constant,T,such,that,r(t,+,T,),=,r(t);,2.,curves,must,form,an,edge-loop,,i.e.,be,part,of,a,set,of,curves,that,together,form,a,closed,loop,,or,in,other,words,,for,each,curve,,both,end,vertices,must,also,be,an,end,vertex,of,another,distinct,curve;,3.,surfaces,(also,referred,to,as,faces),must,not,overlap,and,must,be,enclosed,within,an,edge-loop.,The,CAD,ﬁle,heat-transfer.step,is,provided,in,the,tutorial,folder.,It,is,important,to,note,where,each,edge,is,placed,and,its,ID,as,this,information,will,be,used,later,for,reﬁnement,and,mesh,adaption.,3.1,Coarse,2D,Mesh,Generation,To,create,a,mesh,from,the,STEP,ﬁle,,a,NekMesh,conﬁguration,ﬁle,,.mcf,,needs,to,be,created.,A,barebones,example,ﬁle,contains:,1,<NEKTAR>,2,<MESHING>,3,<INFORMATION>,1M.,Green,,D.,Moxey,,C.,Cantwell,,B.,Liu,,S.,Sherwin,,NEPTUNE,Report,for,D1.1:,r-adapted,meshes,for,the,tokamak,edge,region,,King’s,College,London,&,Imperial,College,London,,Feb,2022,9,10,Chapter,3,2D,Mesh,Generation,Figure,3.1,CAD,representation,of,the,computational,domain,shown,in,ﬁgure,2.1,scaled,for,legibility.,Showing,the,5,distinct,faces,and,16,edges,labelled,by,their,IDs.,4,5,6,7,8,9,10,11,12,13,<I,PROPERTY="CADFile",VALUE="heat−transport.step",/>,<I,PROPERTY="MeshType",VALUE="2D",/>,</INFORMATION>,<PARAMETERS>,<P,PARAM="MinDelta",VALUE="0.005",/>,<P,PARAM="MaxDelta",VALUE="0.05",/>,<P,PARAM="EPS",VALUE="0.1",/>,<P,PARAM="Order",VALUE="4",/>,</PARAMETERS>,</MESHING>,14,15,</NEKTAR>,Six,key,pieces,of,information,are,required,to,run,the,mesh,generator:,•,CADFile,speciﬁes,the,geometry,ﬁle,which,will,be,meshed;,•,MeshType,tells,the,mesher,what,type,of,elements,to,produce:,3D,,3DBndLayer,,2D,,2DBndLayer;,•,MinDelta,,MaxDelta,and,EPS,determine,the,minimum,and,maximum,element,sizes,in,units,of,meter,(m);,•,Order,deﬁnes,the,order,of,the,high-order,mesh.,The,system,automatically,determines,element,sizing,,δ,as,q,δ,=,2R,ε(2,−,ε),(3.1),where,R,is,the,radius,of,curvature,of,the,CAD,entity,and,MinDelta,and,MaxDelta,place,limits,on,the,value,of,δ.,It,should,be,noted,that,,in,the,case,of,constant,radius,geometries,,3.2,Reﬁned,2D,Mesh,Generation,11,such,as,cylinders,,changing,the,value,of,MaxDelta,and,MinDelta,may,not,alter,the,mesh.,That,is,because,in,this,setting,,EPS,is,controlling,the,sizing.,In,the,current,example,,there,is,no,curvature,so,only,MaxDelta,and,the,CAD,edges,determine,the,mesh,spacing.,The,ﬁnal,element,spacing,will,be,determined,by,special,reﬁnement,tags,,which,will,be,explained,in,the,next,section.,First,however,,we,shall,create,a,simple,coarse,mesh,before,adding,the,reﬁnement.,Task,3.1,Create,a,coarse,triangular,mesh,according,to,the,.mcf,speciﬁed,above.,This,is,provided,in,the,tutorial,folder.,To,make,this,mesh,,run,the,command,$NEK/NekMesh,heat-transfer.mcf,heat-transfer.xml,More,details,about,the,generation,process,can,be,seen,by,enabling,the,verbose,command,line,option,-v,:,$NEK/NekMesh,-v,heat-transfer.mcf,heat-transfer.xml,This,will,produce,a,Nektar++,mesh,in,a,.xml,format,,which,we,now,need,to,visualise.,Task,3.2,Visualise,the,mesh,using,FieldConvert.,For,Tecplot,output,for,visualisation,in,VisIt,,run,the,command,$NEK/FieldConvert,heat-transfer.xml,heat-transfer.dat,or,,for,VTK,output,,for,visualisation,in,ParaView,or,VisIt,,run,the,command,$NEK/FieldConvert,heat-transfer.xml,heat-transfer.vtu,The,resulting,mesh,should,be,identical,to,the,mesh,in,ﬁgure,3.2,,as,visualised,in,ParaView.,3.2,Reﬁned,2D,Mesh,Generation,For,the,heat,transport,problem,,we,may,want,the,ﬁeld,lines,to,be,better,resolved.,In,the,following,section,NekMesh,will,be,used,to,reﬁne,speciﬁc,areas,of,the,domain,using,both,the,CAD,curves,as,guides,and,by,employing,additional,user,deﬁned,lines.,Then,,using,the,additional,reﬁnement,,mesh,nodes,will,be,shifted,towards,speciﬁed,CAD,edges,using,the,r-adaption,method,2.,The,outcome,will,be,a,triangular,mesh,with,anisotropic,elements,adjacent,to,the,areas,of,interest.,2J.,Marcon,,G.,Castiglioni,,D.,Moxey,,S.,Sherwin,,J.,Peiró,,rp-adaptation,for,compressible,ﬂows,,International,Journal,for,Numerical,Methods,in,Engineering,,2020,12,Chapter,3,2D,Mesh,Generation,Figure,3.2,Initial,coarse,mesh,generated,by,NekMesh,and,visualised,in,ParaView,using,Feature,Edges,view.,Note,the,y-axis,is,scaled,by,a,factor,of,10,for,better,visibility.,3.3,Reﬁnement,The,reﬁnement,control,takes,place,in,the,.mcf,ﬁle.,A,general,CAD,curve,reﬁnement,control,in,the,.mcf,ﬁle,takes,place,between,REFINEMENT,closes,in,the,following,format:,1,2,3,4,5,6,7,8,9,10,11,12,<REFINEMENT>,<CURVE>,<ID>,10,</ID>,<R>,0.015,</R>,<D>,0.0075,</D>,</CURVE>,<CURVE>,<ID>,12,</ID>,<R>,0.015,</R>,<D>,0.0075,</D>,</CURVE>,</REFINEMENT>,Each,curve,requires,three,key,pieces,of,information:,•,ID,is,the,ID,of,the,CAD,curve,as,deﬁned,in,the,.step,ﬁle;,•,R,where,R,∈,R+,deﬁnes,the,radius,of,inﬂuence,(in,meters),surrounding,the,curve,where,reﬁnement,will,take,place;,•,D,where,D,∈,R+,deﬁnes,the,edge,length,(in,meters),of,the,elements,(element,sizing),generated,within,the,radius,of,inﬂuence.,Note,that,D,overrides,the,minimum,element,sizing,deﬁned,in,MinDelta,,but,it,cannot,increase,it.,00.20.40.60.811.21.41.61.822.22.42.62.833.23.43.63.844.24.44.64.85x,(m)00.020.040.060.080.10.120.140.160.180.2y,(m)00.20.40.60.811.21.41.61.822.22.42.62.833.23.43.63.844.24.44.64.85x,(m)00.020.040.060.080.10.120.140.160.180.2y,(m),3.3,Reﬁnement,13,In,the,example,above,we,selected,the,curves,with,IDs,10,and,12,,which,represents,the,lower,and,upper,bounds,of,the,top,ﬁeld,line,,to,be,reﬁned,with,element,sizing,of,7.5mm,for,any,element,with,a,vertex,within,15mm,from,the,curve.,Similarly,,a,user,deﬁned,line,is,added,as,follows:,1,2,3,4,5,6,7,8,9,10,11,12,<REFINEMENT>,<LINE>,<X1>,0.0,</X1>,<Y1>,0.125,</Y1>,<Z1>,0.0,</Z1>,<X2>,5.0,</X2>,<Y2>,0.05,</Y2>,<Z2>,0.0,</Z2>,<R>,0.005,</R>,<D>,0.0025,</D>,</LINE>,</REFINEMENT>,Rather,than,an,ID,,each,line,requires,six,pieces,of,information,to,deﬁne,the,start,point,X1,,Y1,and,Z1,and,end,point,X2,,Y2,and,Z2,in,3D.,The,additional,two,parameters,,R,and,D,are,identical,to,the,CAD,curve,reﬁnement,explained,above.,In,this,example,an,additional,line,placed,exactly,in,the,centre,of,the,ﬁeld,line,(precisely,in,the,middle,between,the,lower,and,upper,bounds,of,the,CAD,curves),with,a,mesh,size,of,2.5mm,and,a,radius,of,inﬂuence,of,5mm.,Task,3.3,Reduce,the,MaxDelta,size,to,25mm,to,reduce,the,overall,element,size,,then,add,curve,and,lines,reﬁnement,to,the,.mcf,with,the,following:,•,Using,the,CAD,diagram,in,ﬁgure,3.1,,identify,the,curve,IDs,of,the,lower,and,upper,bounds,of,each,of,the,ﬁeld,lines,and,set,the,radius,of,inﬂuence,to,15mm,and,the,element,size,to,7.5mm,(note,that,the,curves,for,the,top,ﬁeld,line,were,given,in,the,example);,•,Identify,the,curve,ID,where,the,ﬁeld,line,intersects,the,box,in,the,lower,right,corner,and,set,the,radius,of,inﬂuence,to,2mm,and,the,element,size,to,2mm;,•,Identify,the,curve,IDs,for,the,vertical,segments,of,the,box,between,the,lower,and,upper,bounds,of,the,ﬁeld,lines,and,set,the,radius,of,inﬂuence,to,1.5mm,and,the,element,size,to,2.5mm;,•,Add,additional,reﬁnement,lines,between,the,bottom,and,upper,bounds,of,the,ﬁeld,lines,with,a,radius,of,inﬂuence,to,5mm,and,the,element,size,to,2.5mm,(note,that,the,line,for,the,top,ﬁeld,line,was,given,in,the,example).,14,Chapter,3,2D,Mesh,Generation,Tip,Generating,the,mesh,with,the,reﬁnement,lines,can,take,a,considerable,amount,of,time.,It,is,recommended,to,check,the,modiﬁed,.mcf,against,the,completed,version,available,in,the,completed,folder,before,moving,on.,3.4,R-adaption,The,last,step,in,the,meshing,process,is,using,the,NekMesh,variational,optimisation,module,,VarOpti,,to,adapt,the,mesh,using,r-adaption,,then,upgrade,the,mesh,to,a,higher,order,and,optimise,the,node,distribution.,To,use,the,module,,NekMesh,is,called,with,the,-m,ﬂag,followed,by,the,name,of,the,module,,in,this,case,-m,varopti,.,The,module,name,is,superseded,by,the,modules,options,,separated,by,:,.,The,basic,basic,options,that,must,be,supplied,to,the,VarOpti,module,are:,•,The,name,of,the,optimisation,method,,e.g.,hyperelastic,or,linearelastic,.,Other,options,are,available,as,discussed,in,reference,3.,•,The,number,of,integration,points,per,edge,nq=N,.,Note,that,the,element,polynomial,order,is,N,−,1.,Task,3.4,Run,a,basic,example,of,executing,NekMesh,with,the,VarOpti,module,using,the,hyperelastic,optimisation,to,create,an,optimised,mesh,with,4th,order,elements,using,the,following,command:,$NEK/NekMesh,-v,-m,varopti:hyperelastic:nq=5,heat-transfer.mcf,heat-transfer.xml,The,variational,optimisation,module,supports,boost,pthreads,for,parallelisation,which,can,be,executed,using,the,numthreads=<num_of_cpu_threads>,option,,e.g.,for,using,8,threads,run,the,following,command:,$NEK/NekMesh,-v,-m,varopti:hyperelastic:nq=6:numthreads=8,heat-transfer.mcf,heat-transfer.xml,3M.,Turner,,J.,Peiró,,D.,Moxey,,Curvilinear,Mesh,Generation,Using,a,Variational,Framework,,Computer-Aided,Design,,2018,3.4,R-adaption,15,Tip,Running,the,optimisation,above,on,the,reﬁned,mesh,could,take,a,considerable,amount,of,time.,For,the,purpose,of,the,tutorial,it,is,recommended,to,ﬁrst,try,the,VarOpti,module,on,the,unreﬁned,mesh,created,in,??.,To,use,the,r-adaption,scheme,,several,additional,options,are,needed,when,executing,the,VarOpti,module:,•,The,IDs,of,the,CAD,curves,on,which,r-adaption,is,applied,radaptcurves,;,•,The,scaling,factor,of,the,Jacobian,radaptscale=<fac>,where,{f,ac,∈,R,:,0,≥,f,ac,≤,1},is,a,non-dimensional,factor.,•,The,radius,of,inﬂuence,surrounding,the,curve,where,r-adaption,is,applied,radaptrad=<rad>,where,{rad,∈,R+},in,units,of,meters,(m);,•,The,number,of,optimisation,iterations,between,applying,the,Jacobian,scaling,subiter=<sit>,;,•,The,maximum,number,of,optimisation,iterations,maxiter=<mit>,where,{mit,≥,sit};,•,The,tolerance,of,the,residual,in,the,optimisation,process,restol=<res>,where,{res,∈,R+,:,res,(cid:28),1}.,16,Chapter,3,2D,Mesh,Generation,The,r-adaption,method,is,most,eﬀective,on,linear,meshes,as,it,allows,the,element,vertices,more,freedom,of,movement,,hence,it,is,recommended,to,be,used,with,the,options,linearelastic:nq=2,ﬁrst,and,then,call,the,module,again,to,upgrade,the,mesh,to,a,higher,order,with,hyperelastic:nq=<N>,where,N,>,2.,Task,3.5,Using,all,of,the,features,discussed,thus,far,,generate,the,ﬁnal,mesh,using,chained,calls,to,the,VarOpti,with,the,following,features:,•,Use,the,verbose,ﬂag,-v,;,•,Call,the,VarOpti,module,with,r-adaption,applied,to,all,the,CAD,curves,without,specifying,a,radius,of,inﬂuence,and,setting,the,scaling,factor,to,0.65,,using,the,linear,elasticity,model,and,linear,elements;,•,Call,the,VarOpti,module,again,with,r-adaption,,specifying,only,the,CAD,curves,representing,the,lower,and,upper,bounds,of,the,ﬁeld,lines,and,setting,the,radius,of,inﬂuence,to,mach,the,radius,of,inﬂuence,of,the,reﬁnement,lines,,5mm,and,a,scaling,factor,of,0.5,,again,using,the,linear,elasticity,model,and,linear,elements;,•,Call,the,VarOpti,one,ﬁnal,time,without,r-adaption,,using,the,hyper,elasticity,model,and,elements,of,order,5.,The,ﬁnal,command,should,look,something,like,the,following:,$NEK/NekMesh,-v,-m,varopti:linearelastic:radaptscale=0.65:,subiter=50:maxiter=1000:restol=1e-5:radaptcurves=1,4-7,10-13:,nq=2:numthreads=8,-m,varopti:linearelastic:radaptscale=0.75:,radaptrad=0.005:subiter=50:maxiter=1000:restol=1e-5:,radaptcurves=1,4,6,10-12:nq=2:numthreads=8,-m,varopti:,hyperelastic:nq=6:numthreads=8,heat-transfer.mcf,heat-transfer.xml,3.4,R-adaption,17,Figure,3.3,Final,reﬁned,and,r-adapted,mesh,visualised,in,ParaView,using,Feature,Edges,view:,(top,left),left,region;,(top,right),right,region;,(bottom),centre,region.,Figure,3.4,Final,reﬁned,and,r-adapted,mesh,visualised,in,ParaView,using,Feature,Edges,view.,Note,the,y-axis,is,scaled,by,a,factor,of,10,for,better,visibility.,0.0010.00150.0020.00250.0030.00350.0040.00450.0050.00550.0060.00650.0070.00750.0080.00850.0090.00950.010.01050.0110.01150.0120.01250.0130.01350.0140.01450.0150.01550.0010.00150.0020.00250.0030.00350.0040.00450.0050.00550.0060.00650.0070.00750.0080.00850.0090.00950.010.01050.0110.01150.0120.01250.0130.01350.0140.01450.0150.015500.20.40.60.811.21.41.61.822.22.42.62.833.23.43.63.844.24.44.64.8x,(m)00.020.040.060.080.10.120.140.160.180.2y,(m)00.20.40.60.811.21.41.61.822.22.42.62.833.23.43.63.844.24.44.64.8x,(m)00.020.040.060.080.10.120.140.160.180.2y,(m),Chapter,4,Solver,Conﬁguration,The,following,sections,describe,how,to,set,up,the,simulation,for,the,thermal,conduction,proxy-app,using,the,mesh,generated,in,Chapter,3,of,the,tutorial.,The,user,will,be,walked,through,how,to,set,up,the,simulation,parameters,,boundary,and,initial,conditions,and,,ﬁnally,,the,solver,properties,for,the,MatrixFree,operators.,4.1,Set,up,parameters,Overall,,the,most,of,the,parameters,set,in,the,element,PARAMETERS,are,used,to,determine,the,values,of,k_par,and,k_perp,,,the,parallel,and,perpendicular,thermal,conduction,coeﬃcients,along,magnetic,ﬁeld,respectively.,The,rest,of,the,parameters,are,related,to,the,transient,simulation,,e.g.,,TimeStep,or,NumSteps,.,A,list,of,parameters,used,for,the,simulation,of,anisotropic,thermal,conduction,is,provided,below.,1,<PARAMETERS>,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,<P>,m_e,=,9.1096e−31,</P>,<P>,m_p,=,1.6726e−27,</P>,<P>,A,=,1.0,</P>,<P>,Z,=,1.0,</P>,<P>,m_i,=,A∗m_p,</P>,<P>,T_e,=,116050,</P>,<P>,T_i,=,T_e,</P>,<P>,epsilon_0,=,8.8542e−12,</P>,<P>,e,=,1.6022e−19,</P>,<P>,k_B,=,1.3807e−23,</P>,<P>,lambda,=,13.0,</P>,<P>,theta,=,atan(0.075/5.0)∗180/PI,</P>,<P>,n,=,1e18,</P>,<P>,B,=,1.0,</P>,<P>,k_par,=,19.2,∗,sqrt(2.0,∗,PI^3.0),∗,(1.0/sqrt(m_e)),∗,(epsilon_0^2.0,/,e^4.0),∗(((k_B,∗,T_e)^(5.0/2.0))/((Z^2.0),∗,lambda)),</P>,<P>,k_perp,=,0.0,</P>,<P>,a,=,1000.0,</P>,<P>,TimeStep,=,0.001,</P>,<P>,FinalTime,=,0.005,</P>,18,4.2,Set,up,boundary,and,initial,Conditions,19,21,22,<P>,NumSteps,=,FinalTime/TimeStep</P>,<P>,IO_CheckSteps,=,5,</P>,<P>,IO_InfoSteps,=,5,</P>,23,24,</PARAMETERS>,where,m_e,,,m_i,and,m_p,are,the,mass,of,electrons,,ions,and,proton,respectively,,and,A=m_i/m_p,.,Z,is,the,ion,charge,state.,T_e,and,T_i,are,the,temperature,of,electrons,and,ions.,epsilon_0,,,e,,,k_B,and,lambda,are,the,permittivity,of,free,space,,the,positive,elementary,charge,,Boltzmann’s,constant,and,the,Coulomb,logarithm.,n,and,B,respectively,are,the,number,density,of,electrons,and,the,strength,of,magnetic,ﬁeld.,theta,deﬁnes,the,tilting,angle,of,the,magnetic,ﬁeld,with,respect,to,the,x,axis,(horizontal,direction,in,the,test,case).,The,user,may,changes,these,values,in,simulations,for,their,own,research,purpose.,4.2,Set,up,boundary,and,initial,Conditions,In,the,test,cases,,the,initial,conditions,of,the,temperature,are,set,to,zero,,as,shown,below.,1,<FUNCTION,NAME="InitialConditions">,2,3,</FUNCTION>,<E,VAR="u",VALUE="0"/>,The,element,BOUNDARYREGIONS,in,the,XML,session,ﬁle,deﬁnes,the,regions,in,the,compu-,tational,domain,on,where,the,boundary,conditions,are,going,to,be,imposed.,For,example,,<B,ID="2">,C[3,4],</B>,means,that,the,3rd,and,4th,COMPOSITE,,,the,2D,edges,in,the,tutorial,cases,,belongs,to,the,2nd,boundary,of,the,computational,domain.,1,<BOUNDARYREGIONS>,2,<B,ID="0">,C[7,9,13,15],</B>,<B,ID="1">,C[16],</B>,<B,ID="2">,C[3,4],</B>,<B,ID="3">,C[2,5,8,11,14],</B>,3,4,9,10,11,12,5,6,</BOUNDARYREGIONS>,7,<BOUNDARYCONDITIONS>,<REGION,REF="0">,8,<N,VAR="u",VALUE="0",/>,</REGION>,<REGION,REF="1">,<N,VAR="u",VALUE="0",/>,</REGION>,<REGION,REF="2">,<N,VAR="u",VALUE="0",/>,</REGION>,<REGION,REF="3">,<D,VAR="u",VALUE="5+5∗tanh(a∗(y−0.125))∗tanh(a∗(0.075−y))",/>,</REGION>,19,20,</BOUNDARYCONDITIONS>,18,13,17,15,14,16,Therefore,,to,impose,a,boundary,condition,along,the,2nd,boundary,of,the,computational,domain,,the,following,element,is,provided,in,the,XML,session,ﬁle,,<REGION,REF="2">,20,Chapter,4,Solver,Conﬁguration,<N,VAR="u",VALUE="0",/>,</REGION>,,,which,says,that,a,Neumann,boundary,condition,of,the,variable,u,is,imposed,along,the,2nd,boundary,of,the,computational,domain.,For,Dirichlet,boundary,condition,,the,user,can,change,the,tag,from,N,to,D,.,4.3,Solver,properties,for,MatrixFree,operators,In,Nektar++,,simulations,are,conﬁgured,using,XML,session,ﬁles.,In,order,to,employ,the,matrix-free,operator,and,SIMD,vectorisation,in,simulations,,the,following,elements,should,be,included,in,the,.xml,ﬁles:,1,<COLLECTIONS,DEFAULT="MatrixFree",/>,and,1,<SOLVERINFO>,2,3,4,<I,PROPERTY="EQTYPE",VALUE="SteadyDiﬀusion"/>,<I,PROPERTY="Projection",VALUE="Continuous"/>,<I,PROPERTY="GlobalSysSoln",VALUE="IterativeFull"/>,<I,PROPERTY="Preconditioner",VALUE="Diagonal"/>,5,6,</SOLVERINFO>,7,8,<GLOBALSYSSOLNINFO>,9,<V,VAR="u">,10,11,12,13,14,15,<I,PROPERTY="GlobalSysSoln",VALUE="IterativeFull"/>,<I,PROPERTY="LinSysIterSolver",VALUE="ConjugateGradient"/>,<I,PROPERTY="Preconditioner",VALUE="Diagonal"/>,<I,PROPERTY="MaxIterations",VALUE="5000"/>,<I,PROPERTY="IterativeSolverTolerance",VALUE="1e−6"/>,<I,PROPERTY="SuccessiveRHS",VALUE=10/>,</V>,16,17,</GLOBALSYSSOLNINFO>,The,<COLLECTIONS,DEFAULT="MatrixFree"/>,element,should,be,added,directly,under,the,root,element,,<NEKTAR>,,,which,forces,the,Nektar++,library,to,use,the,matrix-free,oper-,ator,implementation,for,the,computations.,In,the,.xml,ﬁle,,the,<GLOBALSYSSOLNINFO>,is,added,as,a,sub-element,into,the,<CONDITIONS>,element.,It,deﬁnes,the,parameters,to,control,the,convergence,of,the,chosen,iterative,solver.,In,order,to,activate,the,MatrixFree,operators,,the,IterativeFull,solver,with,ConjugateGradient,algorithm,is,chosen,to,work,with,the,MatrixFree,operators.,For,this,type,of,solver,,the,Diagonal,preconditioner,and,IterativeSOlverTolerance,=,1e-6,are,used.,For,the,transient,simulations,,the,element,SuccessiveRHS,can,be,used,to,reduce,the,number,of,iterations,taken,to,converge,to,a,solution,,where,its,value,represent,how,many,solutions,at,previous,time,step,are,considered,to,give,a,better,initial,guess,for,the,iterative,process.,Chapter,5,Results,Task,5.1,Run,the,solver,for,steady,or,unsteady,cases,of,anisotropic,thermal,conduction,using,MatrixFree,operators,and,visualize,the,result.,In,these,cases,,the,magnetic,ﬁeld,(B),is,not,horizontal,and,has,a,tilt,of,θ,=,49.238,degrees.,The,execution,of,the,program,can,be,done,by,typing,the,following,command,in,the,terminal:,mpirun,-np,n,$HOME/neptune-diffusion/build/dist/DiffusionSolver,domain.xml,conditions.xml,where,$HOME,refers,to,the,home,directory,,n,is,the,number,processors,and,neptune-diﬀusion/build/dist,is,the,installation,directory,of,binary,ﬁles.,Tip,To,prepare,the,mesh,ﬁles,,please,refer,to,the,details,in,Chapter,3.,However,,because,generating,the,mesh,for,the,test,case,can,take,considerable,time,to,complete,,you,may,want,to,run,the,solver,with,the,completed,conﬁgurations,ﬁles,available,in,the,folder,completed.,It,is,recommended,to,initially,attempt,running,the,solver,using,the,coarse,mesh,before,using,the,reﬁned,mesh,in,order,to,reduce,the,computational,time,while,checking,the,setup,of,the,simulation.,For,the,detailed,explanation,of,each,element,in,the,XML,session,ﬁle,,please,refer,to,the,previous,sections.,In,order,to,run,the,steady,cases,,the,element,UnsteadyDiffusion,should,be,changed,to,SteadyDiffusion,and,the,following,element,can,be,removed,from,the,XML,session,ﬁle,,e.g.,,TimeStep,,,FinalTime,,,NumSteps,,,IO_CheckSteps,,,IO_InfoSteps,,,TimeIntegrationMethod,and,SuccessiveRHS,After,running,the,simulations,,the,ﬁnal,task,is,to,visualise,the,results.,21,22,Chapter,5,Results,Task,5.2,Post-process,the,results,by,typing,the,following,command,in,terminal:,$NEK/build/dist/bin/FieldConvert,domain.xml,domain.fld,domain.vtu,and,visualise,the,.vtu,ﬁle,using,Paraview.,Tip,Once,the,simulation,is,done,,the,results,can,be,loaded,and,visualised,in,Paraview,by,following,procedures:,•,Load,result:,File->Open->choose,domain.vtu->Apply,•,Visualize,temperature,ﬁeld:,Coloring->Solid,Color->u,•,Visualize,mesh:,Representation->Surface,With,Edges->Edge,Styling-,>Edge,Color,•,Save,Screenshot:,File->Save,Screenshot,Some,sample,screenshots,of,the,results,are,shown,in,ﬁgures,5.1–5.2.,(a),(b),Figure,5.1,Snapshot,of,the,results,of,variable,u,using,MatrixFree,operators,showing:,(a),the,whole,un-scaled,domain;,(b),the,domain,with,the,y-axis,scaled,by,a,factor,of,10.,00.20.40.60.811.21.41.61.822.22.42.62.833.23.43.63.844.24.44.64.85x,(m),00.02y,(m),00.20.40.60.811.21.41.61.822.22.42.62.833.23.43.63.844.24.44.64.85x,(m),00.02y,(m),-8.6e-011.1e+0102468u00.20.40.60.811.21.41.61.822.22.42.62.833.23.43.63.844.24.44.64.8x,(m),00.010.020.030.040.050.060.070.080.090.10.110.120.130.140.150.160.170.180.190.2y,(m),00.20.40.60.811.21.41.61.822.22.42.62.833.23.43.63.844.24.44.64.8x,(m),00.010.020.030.040.050.060.070.080.090.10.110.120.130.140.150.160.170.180.190.2y,(m),Chapter,5,Results,23,Figure,5.2,Snapshot,of,the,results,of,variable,u,using,MatrixFree,operators,showing,the,un-scaled,domain,with,the,mesh,overlaid:,(left),left,region;,(middle),centre,region;,(right),right,region.,This,completes,the,tutorial.,00.020.040.060.080.10.120.140.160.180.20.2200.0010.0020.0030.0040.0050.0060.0070.0080.0090.010.0110.0120.0130.0140.0150.0160.0170.0180.0190.02y,(m),00.020.040.060.080.10.120.140.160.180.20.2200.0010.0020.0030.0040.0050.0060.0070.0080.0090.010.0110.0120.0130.0140.0150.0160.0170.0180.0190.02y,(m),2.382.42.422.442.462.482.52.522.542.562.582.62.62x,(m),2.382.42.422.442.462.482.52.522.542.562.582.62.62x,(m),4.764.784.84.824.844.864.884.94.924.944.964.9854.764.784.84.824.844.864.884.94.924.944.964.985

:pdfembed:`src:_static/TN-01_AnisotropicHeatTransport.pdf, height:1600, width:1100, align:middle`

