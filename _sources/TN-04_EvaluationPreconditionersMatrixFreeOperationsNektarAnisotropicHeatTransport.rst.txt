TN-04_EvaluationPreconditionersMatrixFreeOperationsNektarAnisotropicHeatTransport
=================================================================================

.. meta::
   :description: technical note

   :keywords: Report,2053622-TN-04,D2.4:,Evaluation,of,preconditioners,of,matrix-free,operations,in,Nektar++,for,anisotropic,heat,transport,Bin,Liu,,Chris,Cantwell,&,Spencer,Sherwin,,Imperial,College,London,Mashy,Green,&,David,Moxey,,King’s,College,London,17th,October,2022,1,Introduction,The,numerical,solution,of,the,diﬀusion,equation,with,anisotropy,plays,an,important,role,in,the,simulation,of,plasma,physics.,The,high,degree,of,anisotropy,in,such,problems,can,lead,to,numerical,challenges,in,solving,such,systems,using,iterative,Krylov-based,algorithms,,due,to,the,resulting,poor,conditioning,of,the,matrices.,To,address,this,,preconditioners,are,often,employed,to,eﬀectively,reduce,the,condition,number,of,the,system,being,solved,and,thereby,signiﬁcantly,reduce,the,number,of,iterations,required,for,convergence,and,ultimately,the,time,to,solution.,The,choice,of,preconditioner,may,be,governed,by,a,number,of,factors,,including,the,structure,of,the,matrix,and,therefore,the,eﬀectiveness,of,the,preconditioner,to,improve,the,conditioning,of,the,matrix,,as,well,as,the,computational,cost,of,evaluating,the,preconditioner.,In,this,report,,we,evaluate,the,performance,of,the,preconditioners,currently,available,,or,under,development,,in,Nektar++,[1],for,solving,the,two-dimensional,steady,anisotropic,thermal,conduction,problem.,We,assess,their,performance,in,terms,of,iteration,count,as,well,as,computational,cost.,2,Problem,formulation,The,general,form,for,heat,conduction,in,plasma,is,3,2,n,dT,dt,=,∇,·,(κs∇T,),+,Q,(1),where,n,,T,,,κs,and,Q,are,the,number,density,of,electrons,,the,temperature,,the,thermal,conductivity,and,the,heat,source,term,,respectively.,Due,to,the,ionized,nature,of,plasma,1,and,the,presence,of,a,strong,magnetic,ﬁeld,,the,dynamics,of,charged,particles,and,the,associated,energy,dissipation,is,highly,anisotropic.,Such,particles,,e.g.,,electrons,and,ions,,move,rapidly,in,tight,spiral,orbits,,known,as,gyro-orbits,,along,the,magnetic,ﬁeld,lines,,but,have,only,a,small,time-averaged,component,of,velocity,along,the,normal,direction,to,the,magnetic,ﬁeld,,e.g.,,κ(cid:107),(cid:29),κ⊥,,typically,10,orders,of,magnitude,diﬀerence,or,more.,The,numerical,consequence,of,anisotropic,thermal,conduction,in,the,magnetized,plasma,is,that,the,thermal,conduction,tensor,,κs,,becomes,non-diagonal.,The,temperature,gradient,is,decomposed,into,three,components/auxiliary,vectors,[2],,deﬁned,with,respect,to,the,unit,direction,of,magnetic,ﬁeld,b,=,B/|B|,as,∇(cid:107)T,=,b(b,·,∇T,),,∇⊥T,=,(b,×,∇T,),×,b,,∇∧T,=,b,×,∇T,,(2),where,∇T,=,∇(cid:107)T,+,∇⊥T,.,∇(cid:107)T,and,∇⊥T,are,the,auxiliary,vectors,along,and,normal,to,the,magnetic,ﬁeld,on,the,b,−,∇T,plane,respectively.,The,auxiliary,vector,∇∧T,accounts,for,the,direction,of,electromagnetic,induction,normal,to,the,b,−,∇T,plane.,It,is,shown,by,Goedbloed,&,Poedts,[2],that,if,a,second,rank,tensor,κs,representing,the,anisotropic,transport,coeﬃcients,is,symmetric,with,respect,to,rotations,about,the,magnetic,ﬁeld,b,,it,implies,that,κs,can,only,have,three,independent,elements,,e.g.,,κ(cid:107),,κ⊥,and,κ∧,,similar,to,the,rotational,tensor,and,have,the,form,κs,=,,,κ⊥,−κ∧,κ⊥,κ∧,0,0,,,.,0,0,κ(cid:107),(3),Assuming,the,magnetic,ﬁeld,is,parallel,to,the,third,axis,of,∇T,and,the,temperature,gradient,can,be,expressed,as,∇T,=,(∂1T,)ˆe1,+,(∂2T,)ˆe2,+,(∂(cid:107)T,)ˆe(cid:107),and,∇(cid:107)T,=,(∂(cid:107)T,)ˆe(cid:107),,∇∧T,=,−(∂2T,)ˆe1,+,(∂1T,)ˆe2,,∇⊥T,=,(∂1T,)ˆe1,+,(∂2T,)ˆe2,(4),Subsequently,the,tensor,and,vector,product,can,be,written,as,κs,·,∇T,=,,,κ⊥,−κ∧,κ⊥,κ∧,0,0,,,·,0,0,κ(cid:107),,,∂1T,∂2T,∂(cid:107)T,,,=,(cid:0)(κ⊥∂1T,),−,(κ∧∂2T,)(cid:1)ˆe1,+,(cid:0)(κ∧∂1T,),+,(κ⊥∂2T,)(cid:1)ˆe2,(κ(cid:107)∂(cid:107)T,)ˆe(cid:107),=,κ(cid:107)∇(cid:107)T,+,κ∧∇∧T,+,κ⊥∇⊥T,=,κ(cid:107)b(b,·,∇T,),+,κ⊥,(cid:0)∇T,−,b(b,·,∇T,)(cid:1),+,κ∧b,×,∇T.,(5),Therefore,the,general,form,of,anisotropic,thermal,conduction,of,magnetized,plasma,in,Equa-,tion,(1),can,be,recast,into,the,form,3,2,n,dT,dt,=,∇,·,=,∇,·,(cid:0)∇T,−,b(b,·,∇T,)(cid:1),+,κ∧b,×,∇T,(cid:104),κ(cid:107)b(b,·,∇T,),+,κ⊥,(cid:104),κ(cid:107)(b,⊗,b),·,∇T,+,κ⊥(I,−,b,⊗,b),·,∇T,+,κ∧b,×,∇T,(cid:104)(cid:0)(κ(cid:107),−,κ⊥)(b,⊗,b),+,κ⊥I(cid:1),·,∇T,=,∇,·,=,∇,·,(cid:0)κc,·,∇T,(cid:1),+,∇,·,[κ∧b,×,∇T,],+,Q,,(cid:105),(cid:105),+,∇,·,[κ∧b,×,∇T,],+,Q,+,Q,(cid:105),+,Q,(6),2,where,I,is,an,identity,matrix.,κc,is,deﬁned,as,the,thermal,conductivity,tensor,,κc,=,(κ(cid:107),−,κ⊥)(b,⊗,b),+,κ⊥I,(cid:21),=,(κ(cid:107),−,κ⊥),bxby,b2,y,(cid:20),b2,x,bxby,x,+,κ⊥,+,(cid:20)κ⊥,0,(cid:21),0,κ⊥,=,(cid:20)(κ(cid:107),−,κ⊥)b2,(κ(cid:107),−,κ⊥)bxby,(κ(cid:107),−,κ⊥)bxby,(κ(cid:107),−,κ⊥)b2,y,+,κ⊥,(cid:21),.,(7),x,=,cs2,,bxby,=,cs,ss,and,b2,If,there,is,an,angle,θ,deﬁning,the,direction,of,the,2D,magnetic,ﬁeld,,b,can,be,deﬁned,as,b,=,[bx,,by](cid:48),=,[cos(θ),,sin(θ)](cid:48),=,[cs,,ss](cid:48),,where,the,superscript,((cid:48)),is,a,transpose,operator.,y,=,ss2.,Consequently,,b2,In,this,study,,since,it,is,assumed,that,the,anisotropic,thermal,conduction,in,magnetized,plasma,is,two-dimensional,,the,induction,direction,κ∧,in,the,third,dimension,(the,term,∇,·,[κ∧b,×,∇T,],in,Equation,(6)),is,neglected.,Therefore,,the,implemented,strong,form,of,two-dimensional,anisotropic,thermal,conduction,becomes,3,2,n,dT,dt,=,∇,·,(cid:20)(cid:0)(κ(cid:107),−,κ⊥)cs2,+,κ⊥,(cid:1)∂xT,+,(cid:0)(κ(cid:107),−,κ⊥)cs,ss(cid:1)∂yT,(cid:0)(κ(cid:107),−,κ⊥)cs,ss(cid:1)∂xT,+,(cid:0)(κ(cid:107),−,κ⊥)ss2,+,κ⊥)∂yT,(cid:21),+,Q.,(8),For,the,purpose,of,this,report,to,assess,preconditioners,,we,consider,the,steady,case,where,∂T,∂t,=,0,,that,is,−∇,·,(κc,·,∇T,),=,Q.,(9),2.1,Numerical,Discretisation,The,anisotropic,steady,diﬀusion,equation,is,of,Poisson,type,but,,for,consistency,with,the,Nektar++,implementation,,can,be,treated,as,an,inhomogeneous,Helmholtz,equation,with,the,scalar,constant,λ,=,0,,given,by,−∇,·,(κc,·,∇T,)+λT,=,Q,(10),where,κc,,λ,and,Q,are,the,anisotropic,diﬀusion,tensor,,reaction,coeﬃcient,and,a,forcing,term,in,the,ﬁeld,,respectively.,Applying,the,Galerkin,method,of,weighted,residuals,to,Equa-,tion,(10),and,the,divergence,theorem,on,the,Laplacian,operator,,its,variational,form,satisﬁes,(cid:90),Ω,[∇vh(κc,·,∇T,h)]dΩ+λ,(cid:90),Ω,[vhT,h]dΩ,=,(cid:90),[vhQ]dΩ,Ω,(cid:90),+,Γ,[vh(κc,·,∇T,h),·,n]dΓ,(11),for,all,test,functions,vh.,Now,dropping,the,h,superscript,for,clarity,,we,can,expand,T,h,and,vh,in,terms,of,the,basis,functions,on,each,element,,T,e,=,(cid:88),ˆT,eψe,i,,,i,3,where,the,superscript,(“e”),refers,to,elemental,quantities.,Expressing,as,a,matrix,system,,we,arrive,at,Le,ˆT,e,+,λM,e,ˆT,e,=,BW,eQe,+,Γ,(12),where,the,matrices,Le,,M,e,and,Be,respectively,are,the,discrete,representations,of,Laplacian,,mass,and,basis,evaluation,operators.,W,e,is,a,diagonal,matrix,of,quadrature,weights,and,ˆT,e,is,the,matrix,of,elemental,basis,functions,φi,evaluated,at,the,quadrature,points,,ξj.,For,the,non-zero,surface,ﬂux,,the,vector,Γ,is,introduced,to,represent,the,boundary,integral,term,in,equation,(11).,In,terms,of,fundamental,operators,,Le,and,M,e,can,be,written,as,Le,=,(DeB)ge(DeB)T,W,e,M,e,=,BW,e(B)T,(13a),(13b),where,D,,B,and,W,respectively,are,the,one-dimensional,derivative,matrix,,basis,matrix,and,diagonal,weight,of,numerical,integration,in,the,standard,region,element,ξ,⊂,[−1,,1]d,(uniquely,deﬁned,for,each,element,type).,The,metric,,ge,,incorporates,the,diﬀusion,tensor,κc,and,the,inverse,of,Jacobian,matrix,J,,,as,ge,=,(J,e)−1κc(J,e)−T,=,(cid:21),(cid:20)g00,g01,g10,g11,(J,e)−1,=,(cid:21),κc,=,(cid:20)κ00,κ01,κ10,κ11,(cid:21),(cid:20)j00,j01,j11,j10,g00,=,κ00j2,g01,=,g10,=,κ00j00j10,+,κ01(j01j10,+,j00j11),+,κ11j01j11,g11,=,κ00j2,00,+,2κ01j00j01,+,κ11j2,01,10,+,2κ01j10j11,+,κ11j2,11.,(14a),(14b),(14c),3,Implementation,The,equations,above,are,implemented,in,the,nektar-diﬀusion,solver,,reported,on,previously,[3].,In,this,section,,we,highlight,the,currently,available,preconditioners,,as,well,as,a,p-,multigrid,preconditioner,which,is,under,development.,3.1,Matrix,types,The,global,linear,system,constructed,through,the,discretisation,of,the,Helmholtz,operator,can,be,solved,as,a,full,matrix,system,explicitly,,or,by,ﬁrst,statically,condensing,the,matrix.,The,former,solves,for,all,degrees,of,freedom,using,a,single,linear,system.,The,latter,proceeds,as,follows.,The,degrees,of,freedom,in,each,element,are,reordered,to,put,those,on,the,boundaries,of,the,element,ﬁrst,,followed,by,those,on,the,interior.,Due,to,the,choice,of,modiﬁed,Legendre,4,basis,,the,interior,degrees,of,freedom,are,naturally,decoupled,from,neighbouring,elements.,Combining,these,block,matrices,from,all,elements,,we,construct,an,assembled,element-block,matrix,system,consisting,of,a,boundary-boundary,block,,and,interior-interior,block,and,two,oﬀ-diagonal,boundary-interior,blocks.,We,can,therefore,express,the,system,to,solve,as:,(cid:20),Mb,Mc,M,(cid:62),c,Mi,(cid:21),(cid:20),xb,xi,(cid:21),=,(cid:20),fb,fi,(cid:21),Performing,block,elimination,,we,solve,this,system,in,two,steps:,ﬁrst,by,using,the,iterative,conjugate,gradient,solver,with,the,Schur,complement,matrix,to,calculate,the,boundary,degrees,of,freedom,,then,second,by,solving,for,the,remaining,interior,degrees,of,freedom,by,trivially,inverting,each,elemental,block.,Due,to,the,reduced,rank,of,the,linear,system,,this,approach,generally,provides,improved,performance,over,the,full,matrix,system,solve.,3.2,Available,preconditioners,Within,the,Nektar++,framework,a,number,of,preconditioners,are,available,to,speed,up,the,convergence,rate,of,the,conjugate,gradient,solver.,The,table,below,summarises,each,method,,the,dimensions,of,elements,which,are,supported,,and,also,the,discretisation,type,support,which,can,either,be,continuous,(CG),or,discontinuous,(hybridizable,DG).,We,also,note,which,type,of,linear,systems,the,preconditioners,can,be,applied,to.,Name,None,Diagonal,(Jacobi),Block,LowEnergyBlock,FullLinearSpace,FullLinearSpaceWithDiagonal,FullLinearSpaceWithBlock,FullLinearSpaceWithLowEnergyBlock,3D,Dimensions,Discretisations,Matrix-type,All,All,2/3D,3D,All,All,2/3D,All,All,All,StaticCond,StaticCond,StaticCond,StaticCond,StaticCond,All,All,All,CG,CG,CG,CG,CG,Table,1:,Available,preconditioners,in,Nektar++.,Only,those,supporting,2D,domains,and,continuous,Galerkin,projection,are,considered,in,this,report.,Two,matrix-types,can,be,used:,(multi-level),static,condensation,and,full,matrix.,The,default,preconditioner,with,the,iterative,conjugate,gradient,solver,in,Nektar++,is,the,Diagonal,preconditioner.,The,preconditioner,and,solution,method,can,be,chosen,through,the,session,ﬁle.,For,example,,to,enable,FullLinearSpace,preconditioner,with,the,statically-,condensed,system,one,can,use:,<I,PROPERTY="GlobalSysSoln",VALUE="IterativeStaticCond",/>,<I,PROPERTY="Preconditioner",VALUE="FullLinearSpace",/>,5,Alternatively,one,can,have,more,control,over,diﬀerent,preconditioners,for,each,solution,ﬁeld,by,using,the,GlobalSysSoln,section,of,the,XML,ﬁle,(for,more,details,,consult,the,user,guide,of,Nektar++).,We,now,discuss,the,structure,of,each,of,the,preconditioners.,3.2.1,Diagonal,Diagonal,(or,Jacobi),preconditioning,is,amongst,the,simplest,preconditioning,strategies,and,is,particularly,eﬀective,when,the,matrix,is,diagonally,dominant.,In,this,scheme,one,extracts,the,diagonal,terms,hii,of,the,matrix,and,forms,the,preconditioner,as,a,diagonal,matrix,M,−1,=,(h−1,ii,),3.2.2,Block,Block,preconditioning,of,the,C,0,continuous,system,is,deﬁned,by,M,−1,=,,,(S−1,1,)vv,0,0,0,(S−1,1,)eb,0,,,,,0,0,(S−1,1,)ef,(15),where,diag[(S1)vv],is,the,diagonal,of,the,vertex,modes,,(S1)eb,and,(S1)f,b,are,block,diagonal,matrices,corresponding,to,coupling,of,an,edge,(or,face),with,itself,i.e,ignoring,the,coupling,to,other,edges,and,faces.,In,previous,studies,,this,preconditioner,was,generally,found,to,be,best,suited,for,two,dimensional,problems.,3.2.3,Linear,space,The,linear,space,(or,coarse,space),of,the,matrix,system,is,that,containing,degrees,of,freedom,corresponding,only,to,the,vertex,modes,in,the,high-order,system.,Preconditioning,of,this,space,is,achieved,by,forming,the,matrix,corresponding,to,the,coarse,space,and,inverting,it,,so,that,M,−1,=,(S−1,1,)vv.,(16),Since,the,mesh,associated,with,higher,order,methods,is,relatively,coarse,compared,with,traditional,ﬁnite,element,discretisations,,the,linear,space,can,usually,be,directly,inverted,without,memory,issues.,However,such,a,methodology,can,be,prohibitive,on,large,parallel,systems,,due,to,a,bottleneck,in,communication.,In,Nektar++,the,inversion,of,the,linear,space,preconditioner,is,handled,using,the,XX,T,library,[4].,XX,T,is,a,parallel,direct,solver,for,problems,of,the,form,Aˆx,=,ˆb,based,around,a,sparse,factorisation,of,the,inverse,of,A.,To,precondition,utilising,this,methodology,the,linear,subspace,is,gathered,from,the,expansion,and,the,preconditioned,residual,within,the,CG,routine,is,determined,by,solving,6,(S1)vv,ˆz,=,ˆr.,(17),The,preconditioned,residual,ˆz,is,then,scattered,back,to,the,respective,location,in,the,global,degrees,of,freedom.,3.2.4,Geometrically,informed,Algebraic,multigrid,(AMG),preconditioner,It,is,well-known,that,multigrid,methods,are,preferred,method,for,solving,the,resulting,sym-,metric,linear,system,with,optimal,and,mesh-independent,convergence.,However,,when,used,with,unstructured,meshes,,the,use,of,geometric,multigrid,(GMG),is,not,straightforward,,requiring,the,use,of,algebraic,multigrid,(AMG),instead.,Unlike,GMG,,where,the,coarse-grid,operators,are,typically,obtained,via,geometric,coarsening,and,rediscretizations,,AMG,does,not,use,the,geometric,information,but,instead,builds,the,coarse,grid,operators,algebraically.,Algebraic,coarsening,results,in,a,loss,of,sparsity,,leading,to,poor,performance,and,scalability,,especially,for,large-scale,problems.,This,is,usually,addressed,by,employing,sparsity,control,techniques,,such,as,dropping,values,below,a,speciﬁed,threshold,at,coarser,levels.,Such,mea-,sures,can,address,the,sparsity,issues,,albeit,with,some,loss,of,convergence,rates.,Additionally,,they,introduce,an,additional,parameter,that,needs,to,be,tuned,,making,the,overall,solver,or,preconditioner,less,robust.,This,issue,is,exacerbated,for,high-order,operators,that,are,denser,to,begin,with,,and,get,even,denser,on,coarser,grids,,leading,to,poor,scalability.,In,some,sense,the,linear,space,preconditioner,outlined,in,Section,3.2,can,be,viewed,as,a,form,of,multigrid,,where,in,a,single-level,V-cycle,the,restriction,operator,is,the,extraction,of,linear,modes,and,no,smoothing,is,performed.,However,the,reliance,on,X,T,X,imposes,natural,scalability,restrictions,so,that,beyond,104,cores,,and,the,lack,of,smoothing,does,not,guarantee,many,of,the,convergence,properties,that,a,multigrid,method,should,theoretically,provide.,In,work,currently,being,developed1,,to,circumvent,this,problem,we,are,considering,a,geomet-,rically,informed,algebraic,multigrid,approach,(GIAMG),,implemented,in,the,Saena,library,,in,which,we,perform,two,phases:,(cid:136),p-coarsening:,in,which,the,problem,is,coarsened,by,reducing,the,polynomial,order,of,the,basis,functions,and,degrees,of,freedom,within,each,element,,resulting,in,a,local,coarsening;,followed,by,(cid:136),algebraic,h-coarsening:,also,known,as,algebraic,multigrid,(AMG),,in,which,the,mesh,is,coarsened,based,on,the,speciﬁc,matrix,connectivity,properties.,This,is,visualised,in,Figure,1.,We,note,that,for,the,grids,obtained,using,p-coarsening,,we,eﬀectively,increase,the,sparsity,as,we,go,to,coarser,levels.,This,enables,us,to,oﬀset,1A,geometrically,informed,algebraic,multigrid,preconditioned,iterative,approach,for,solving,high-order,ﬁnite,element,systems.,S.,Xu,,M.,Rasouli,,R.,M.,Kirby,,D.,Moxey,and,H.,Sundar,,under,review,in,Numerical,Linear,Algebra,with,Applications.,7,Figure,1:,Illustration,of,the,coarsening,strategy,of,GIAMG,for,quadrilateral,elements,with,nodal,basis,of,polynomial,order,p,=,4.,First,,We,p-coarsen,from,p,=,4,to,p,=,2,,and,then,again,p-coarsen,from,p,=,2,to,p,=,1.,The,total,number,of,elements—and,therefore,the,mesh—does,not,change,during,p-coarsening.,Once,we,reach,linear,elements,,we,perform,h-coarsening,to,obtain,a,coarser,mesh,and,smaller,system.,the,loss,of,sparsity,encountered,when,generating,coarser,levels,using,AMG.,This,plays,a,major,part,in,ensuring,that,the,overall,scalability,remains,good.,In,addition,,if,the,high-,order,system,is,generated,using,a,modal,basis,,then,the,restriction,operation,is,simply,an,injection,,i.e.,,a,lower,order,mode,is,injected,to,the,coarser,level.,This,indicates,the,prolongation,and,restriction,operators,will,only,have,zero-,or,single-valued,entries.,As,a,result,,it,is,extremely,eﬃcient,to,perform,p-coarsening,for,such,high-order,systems.,Note,when,using,modal,basis,,the,sparsity,of,coarser,level,matrices,is,further,reduced,due,to,the,injection,during,interpolation,,compared,to,using,a,nodal,basis.,The,integration,of,the,Saena,code,within,Nektar++,is,currently,a,work,in,progress,,but,our,initial,version,of,this,can,be,found,on,the,main,Nektar++,repository,under,the,feature/saena,branch,,which,can,be,enabled,through,the,NEKTAR,USE,SAENA,CMake,setting.,Note,that,this,is,presently,experimental,and,thus,should,be,considered,unstable.,We,also,note,that,there,are,signiﬁcant,performance,optimisations,that,are,still,required,to,make,this,production-ready,,and,thus,walltimes,may,not,be,representative,of,the,potential,for,this,method,at,present.,Our,current,focus,is,on,attaining,greater,performance,of,the,solver,in,parallel,execution,,the,reduction,of,setup,times,in,construction,of,the,matrix,systems,,as,well,as,other,potential,improvements,such,as,the,use,of,matrix-free,methods,within,the,V-cycle.,4,Comparison,of,available,preconditioners,Preconditioners,were,assessed,using,the,steady,anisotropic,heat,transport,problem,described,in,2.,The,computational,domain,is,a,unit,square,region,,(x,,y),=,([0,,1],,[0,,1]),,as,shown,in,Figure,2.,The,domain,was,discretised,using,a,uniform,quad,mesh,with,160,elements,in,each,direction,,with,a,third-order,polynomial,tensor-product,modiﬁed-Legendre,basis,in,each,element.,The,traction-free,boundary,condition,is,imposed,along,the,top,,bottom,and,right,boundaries.,A,combination,of,hyperbolic,tangent,functions,is,imposed,along,the,left,boundary,to,represent,the,proﬁle,of,the,SOL,,the,green,line,in,Figure,2.,The,magnetic,ﬁeld,direction,B,is,shown,as,the,red,solid,line,,which,has,an,angle,θ,with,respect,to,the,x-axis.,8,Figure,2:,Schematic,diagram,of,computational,domain,showing,imposed,temperature,proﬁle,on,the,left,boundary,and,angle,of,anisotropy.,Neumann,boundary,conditions,are,imposed,on,the,upper,,lower,and,right,boundaries.,The,performance,of,the,preconditioners,was,assessed,on,the,following,metrics:,(cid:136),the,number,of,iterations,required,for,the,CG,algorithm,to,converge;,(cid:136),the,total,execution,time,for,the,solve.,The,diﬀerent,preconditioners,were,compared,by,ﬁxing,κ(cid:107),=,1,and,varying,κ⊥,to,achieve,diﬀerent,levels,of,anisotropy,,as,well,as,ﬁxing,κ(cid:107),=,1,and,κ⊥,=,0,and,varying,the,transport,angle,of,between,0◦,and,45◦,with,respect,to,the,x-axis.,Greater,angular,resolution,was,used,for,small,angles,,since,these,are,of,most,interest,to,the,NEPTUNE,project.,4.1,Experimental,details,Results,were,obtained,by,executing,the,nektar-diﬀusion,solver,to,solve,the,Helmholtz,prob-,lem,arising,from,the,steady,system.,Preconditioners,applied,to,the,full,matrix,system,and,statically,condensed,system,were,assessed.,For,the,full,matrix,system,,the,matrix-free,ker-,nels,were,used.,These,are,not,available,for,the,statically,condensed,system.,All,tests,use,a,polynomial,order,of,4.,The,speciﬁcations,of,the,CPU,hardware,used,to,assess,the,perfor-,mance,are,listed,in,Table,2.,The,solver,was,executed,using,36,MPI,ranks,to,fully,utilise,all,ﬂoating-point,units,on,the,machine.,9,Architecture,Model,Clock,speed,L3,Cache,size,Number,of,Sockets,Cores,per,socket,Intel(R),Xeon(R),E5-2697,v4,2.3,Ghz,46080,KB,2,18,Table,2:,Speciﬁcation,of,CPU,used,for,obtaining,the,results,presented,in,this,report.,Figure,3:,Full-matrix,iteration,count,for,diﬀerent,preconditioners,as,a,function,of,anisotropic,ratio.,4.2,Full,matrix,system,Initially,,we,investigate,the,impact,of,the,anisotropic,ratio,on,the,performance,of,the,diﬀerent,preconditioners.,The,preconditioners,investigated,in,this,case,are,the,diagonal,preconditioner,and,the,Saena,p-multigrid,preconditioner.,The,parallel,diﬀusivity,is,ﬁxed,at,1.0,,while,the,perpendicular,diﬀusivity,is,reduced,from,1.0,towards,zero,to,obtain,diﬀerent,anisotropic,ratios,κ(cid:107)/κ⊥.,The,angle,of,diﬀusivity,is,0◦,and,is,therefore,grid,aligned.,Figure,3,shows,how,the,iteration,count,of,these,preconditioners,changes,with,anisotropic,ratio.,No,preconditioning,typically,attracts,the,highest,number,of,iterations,,as,would,be,expected,,with,the,diagonal,preconditioner,reducing,this,noticeably,,but,only,at,higher,anisotropic,ratios.,The,Saena,preconditioner,has,a,substantially,lower,iteration,count,across,the,entire,range,of,angles,considered.,The,block,preconditioner,was,found,to,have,exactly,the,same,performance,as,the,diagonal,preconditioner,and,is,therefore,not,shown,explicitly,on,the,plot.,To,understand,the,real-world,impact,of,these,preconditioners,,Figure,4,shows,the,overall,10,0,1000,2000,3000,4000,5000,60001001021041061081010IterationsAnisotropic,RatioNoneDiagSaena,Figure,4:,Full-matrix,solve,time,for,diﬀerent,preconditioners,as,a,function,of,anisotropic,ratio.,time,taken,to,complete,the,solve.,At,low,anisotropic,ratios,,no,preconditioning,actually,provides,the,fastest,solve,time.,This,is,likely,because,of,the,already,low,condition,number,of,the,matrix,and,grid,alignment,of,the,diﬀusivity,tensor;,diagonal,preconditioning,and,the,Saena,preconditioner,do,not,provide,a,suﬃcient,reduction,in,condition,number,to,oﬀset,their,additional,cost,in,this,regime.,At,higher,anisotropic,ratios,when,the,matrix,becomes,more,ill-conditioned,,both,preconditioners,are,eﬀective,at,reducing,both,iteration,count,and,overall,solve,time.,Although,not,shown,,with,κ⊥,set,to,zero,the,eﬀect,of,changing,κ(cid:107),on,the,iteration,count,of,the,solve,was,found,to,be,minimal.,We,next,investigate,the,impact,of,transport,angle,on,the,performance,of,the,preconditioners.,A,non-zero,transport,angle,leads,to,a,non-grid,aligned,ﬁeld,and,therefore,also,introduces,a,change,in,the,conditioning,of,the,matrix,system.,Figure,5,shows,the,change,in,the,iteration,count,as,transport,angle,is,varied,for,the,two,preconditioners,and,the,baseline,case,of,no,preconditioning.,There,is,a,clear,and,sub-,stantial,reduction,in,iteration,count,for,small,deviations,from,the,grid-aligned,case,,across,both,preconditioners.,This,observation,may,be,explained,as,follows.,The,angle,appears,in,the,anisotropic,thermal,conductivity,tensor,in,the,product,of,trigonometric,functions,,e.g.,,sin(θ),cos(θ),(on,the,oﬀ-diagonal,components),,cos(θ),cos(θ),(on,the,diagonal,component),and,sin(θ),sin(θ),(on,the,diagonal,component).,If,θ,is,small,,sin(θ),sin(θ),term,is,very,close,to,zero,and,this,makes,the,thermal,conductivity,matrix,more,singular,which,leads,to,slower,convergence,of,the,iterative,solver,compared,to,larger,angles.,The,iteration,count,then,sat-,urates,above,approximately,10◦.,The,diagonal,preconditioner,reduces,the,iteration,count,by,approximately,one-third,for,low,angles,,although,provides,negligible,beneﬁt,for,high,angles.,The,Saena,preconditioner,reduces,the,iteration,count,substantially,,but,its,beneﬁt,is,lost,by,its,substantially,higher,cost,,as,evident,in,Figure,6,,where,in,fact,using,no,preconditioning,out-performs,it,for,larger,angles.,11,0,1,2,3,4,5,6,71001021041061081010Time,(s)Anisotropic,RatioNoneDiagSaena,Figure,5:,Iteration,count,of,the,conjugate,gradient,solver,when,using,no,preconditioner,,the,diagonal,preconditioner,or,the,experimental,Saena,preconditioner,for,diﬀerent,transport,angles.,For,all,experiments,κ(cid:107),=,1,and,κ⊥,=,0.,Figure,6:,Full-matrix,solve,time,for,diﬀerent,angles,of,diﬀusivity,,when,using,no,preconditioner,,a,diagonal,preconditioner,or,the,experimental,Saena,preconditioner.,For,all,experiments,κ(cid:107),=,1,and,κ⊥,=,0.,12,0,1000,2000,3000,4000,5000,6000,0,5,10,15,20,25,30,35,40,45IterationsAngle,(deg)NoneDiagSaena,0,1,2,3,4,5,6,7,0,5,10,15,20,25,30,35,40,45Time,(s)Angle,(deg)NoneDiagSaena,Figure,7:,Statically,condensed,matrix,conjugate,gradient,iteration,count,for,diﬀerent,angles,of,diﬀusivity,when,using,no,preconditioner,,the,diagonal,preconditioner,or,the,linear,space,preconditioner.,For,all,experiments,κ(cid:107),=,1,and,κ⊥,=,0.,4.3,Static-condensed,matrix,system,We,next,investigate,the,performance,of,preconditioners,in,the,context,of,using,a,statically,condensed,matrix,system.,Due,to,the,requirement,to,substructure,the,matrix,,the,matrix-,free,kernels,were,not,used,for,these,tests.,Figure,7,shows,the,iteration,count,of,the,conjugate,gradient,solver,when,using,the,diﬀerent,preconditioners,,for,diﬀerent,angles,of,diﬀusivity.,As,for,the,full-matrix,case,,it,is,evident,that,the,iteration,count,is,particularly,high,for,the,grid-aligned,diﬀusivity,,but,quickly,reduces,for,non-aligned,diﬀusivity,,as,for,the,full-matrix,case.,Additionally,,as,with,the,full,matrix,case,,the,diagonal,preconditioner,performs,well,for,low-angles,,but,provides,little,advantage,at,high,angles,of,diﬀusivity.,For,the,statically,condensed,case,,we,also,consider,the,full,linear,space,preconditioner.,For,angles,≥,1◦,,this,provides,comparable,or,better,iteration,counts,than,the,diagonal,preconditioner.,The,solve,times,for,these,cases,are,compared,in,Figure,8.,Notably,,these,times,are,lower,than,those,in,Figure,6;,this,is,primarily,due,to,the,reduced,system,size,leading,to,a,more,eﬃcient,solution,procedure,,even,without,the,availability,of,the,matrix-free,kernels.,The,diagonal,preconditioner,provides,a,performance,gain,for,low,angles,of,diﬀusivity,,but,this,quickly,becomes,of,negligible,beneﬁt,at,higher,angles.,While,the,full,linear,space,preconditioner,provided,reduced,iteration,counts,,it,in,fact,is,slower,than,not,using,a,preconditioner,at,all.,13,0,1000,2000,3000,4000,5000,6000,0,5,10,15,20,25,30,35,40,45IterationsAngle,(deg)NoneDiagFullLinearSpace,Figure,8:,Statically,condensed,matrix,solve,time,for,diﬀerent,angles,of,diﬀusivity,,when,using,no,preconditioner,,the,diagonal,preconditioner,or,the,linear,space,preconditioner.,4.4,Limitations,The,test,case,considered,is,that,of,a,steady,heat,transport,problem.,Performance,mea-,surements,include,the,complete,set-up,and,solution,of,the,linear,system.,These,results,are,therefore,not,representative,of,time-integrating,an,unsteady,heat,transport,problem.,This,is,particularly,evident,for,the,full-linear,space,preconditioner,,due,to,the,high,cost,of,setting,up,the,preconditioner.,Using,it,requires,the,direct,parallel,Cholesky,factorisation,and,inversion,of,the,resulting,preconditioner,matrix.,In,the,case,of,this,problem,,this,dominates,the,cost.,For,time-dependent,problems,where,the,preconditioner,would,be,applied,repeatedly,at,each,time-step,,this,set-up,cost,would,only,occur,once,and,so,the,preconditioner,would,provide,a,greater,advantage.,We,also,note,that,timings,were,found,to,be,quite,variable,for,the,conﬁguration,tested.,Repeated,runs,of,the,same,case,might,give,variability,of,up,to,10%,in,the,measured,runtime.,This,could,due,to,the,allocation,of,resources,by,the,operating,system,,I/O,contention,and,the,movement,of,processes,between,NUMA,regions.,While,the,minimum,runtime,from,multiple,runs,was,recorded,,this,might,explain,some,of,the,irregularities,evident,in,the,timing,plots.,Finally,,the,performance,of,the,Saena,preconditioner,will,improve,signiﬁcantly,with,continued,development.,At,present,,the,use,of,matrix-free,operations,was,not,possible,with,the,current,version,of,the,library,,but,is,expected,to,be,available,in,a,future,version.,14,0,0.5,1,1.5,2,2.5,3,3.5,4,0,5,10,15,20,25,30,35,40,45Time,(s)Angle,(deg)NoneDiagFullLinearSpace,5,Conclusion,This,report,summarises,the,relevant,available,preconditioners,in,Nektar++,and,their,suit-,ability,to,accelerate,the,conjugate,gradient,solver,when,solving,the,steady,anisotropic,heat,transport,formulation.,Since,it,is,anticipated,that,ﬁeld-aligned,grids,will,likely,be,used,,the,transport,angle,is,likely,to,be,low.,At,current,stage,,it,was,found,that,the,diagonal,precon-,ditioner,is,the,most,eﬀective,preconditioner,currently,available,to,improve,the,convergence,rate,of,the,iterative,solver,for,the,steady,problem.,However,,iteration,counts,are,still,high,and,further,work,is,needed,to,explore,the,use,of,other,preconditioners,for,this,problem.,Un-,steady,problems,,where,a,linear,system,is,repeatedly,solved,will,show,diﬀerent,performance,characteristics,,particularly,for,the,linear,space,and,p-multigrid,preconditioners,,since,the,expensive,set-up,stage,will,only,be,required,once,,and,further,experiments,are,required,to,assess,this,case.,References,[1],Chris,D,Cantwell,,David,Moxey,,Andrew,Comerford,,Alessandro,Bolis,,Gabriele,Rocco,,Gianmarco,Mengaldo,,Daniele,De,Grazia,,Sergey,Yakovlev,,J-E,Lombard,,Dirk,Ekelschot,,et,al.,Nektar++:,An,open-source,spectral/hp,element,framework.,Computer,physics,communications,,192:205–219,,2015.,[2],JP,Hans,Goedbloed,,JP,Goedbloed,,and,Stefaan,Poedts.,Principles,of,magnetohydrody-,namics:,with,applications,to,laboratory,and,astrophysical,plasmas.,Cambridge,university,press,,2004.,[3],Bin,Liu,,Chris,Cantwell,,and,Spencer,Sherwin.,Matrix-free,kernel,for,the,anisotropic,Laplacian,operator,for,x86,architectures.,Technical,report,,Imperial,College,London,/,UKAEA,,2021.,[4],Nicolas,Oﬀermans,,Adam,Peplinski,,Oana,Marin,,Elia,Merzari,,and,Philipp,Schlatter.,Performance,of,preconditioners,for,large-scale,simulations,using,nek5000.,In,Spectral,and,High,Order,Methods,for,Partial,Diﬀerential,Equations,ICOSAHOM,2018,,pages,263–272.,Springer,,Cham,,2020.,[5],George,Em,Karniadakis,,George,Karniadakis,,and,Spencer,Sherwin.,Spectral/hp,element,methods,for,computational,ﬂuid,dynamics.,Oxford,University,Press,on,Demand,,2005.,15

:pdfembed:`src:_static/TN-04_EvaluationPreconditionersMatrixFreeOperationsNektarAnisotropicHeatTransport.pdf, height:1600, width:1100, align:middle`

